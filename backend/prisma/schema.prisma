generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model audit_logs {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id     String?   @db.Uuid
  action      String    @db.VarChar(100)
  entity_type String?   @db.VarChar(50)
  entity_id   String?   @db.Uuid
  changes     Json?
  ip_address  String?   @db.Inet
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  users       users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model carriers {
  id                String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code              String       @unique @db.VarChar(50)
  name              String       @db.VarChar(255)
  service_type      String?      @db.VarChar(50)
  contact_email     String?      @db.VarChar(255)
  contact_phone     String?      @db.VarChar(20)
  reliability_score Decimal?     @default(0.85) @db.Decimal(3, 2)
  is_active         Boolean?     @default(true)
  created_at        DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?    @default(now()) @db.Timestamptz(6)
  invoices          invoices[]
  rate_cards        rate_cards[]
  shipments         shipments[]
}

model eta_predictions {
  id                 String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shipment_id        String?    @db.Uuid
  predicted_delivery DateTime?  @db.Timestamptz(6)
  confidence_score   Decimal?   @db.Decimal(3, 2)
  delay_risk_score   String?    @db.VarChar(20)
  factors            Json?
  created_at         DateTime?  @default(now()) @db.Timestamptz(6)
  shipments          shipments? @relation(fields: [shipment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model exceptions {
  id               String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  exception_type   String?    @db.VarChar(50)
  severity         String?    @db.VarChar(20)
  shipment_id      String?    @db.Uuid
  order_id         String?    @db.Uuid
  description      String?
  status           String?    @default("open") @db.VarChar(50)
  assigned_to      String?    @db.Uuid
  resolution       String?    @db.VarChar(50)
  resolution_notes String?
  sla_impacted     Boolean?   @default(false)
  created_at       DateTime?  @default(now()) @db.Timestamptz(6)
  resolved_at      DateTime?  @db.Timestamptz(6)
  users            users?     @relation(fields: [assigned_to], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders           orders?    @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  shipments        shipments? @relation(fields: [shipment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([status], map: "idx_exceptions_status")
}

model inventory {
  id                 String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  warehouse_id       String?     @db.Uuid
  product_id         String?     @db.Uuid
  available_quantity Int?        @default(0)
  reserved_quantity  Int?        @default(0)
  damaged_quantity   Int?        @default(0)
  last_stock_check   DateTime?   @db.Timestamptz(6)
  created_at         DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?   @default(now()) @db.Timestamptz(6)
  products           products?   @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses         warehouses? @relation(fields: [warehouse_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([warehouse_id, product_id])
  @@index([warehouse_id], map: "idx_inventory_warehouse")
}

model invoices {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  invoice_number       String    @unique @db.VarChar(50)
  carrier_id           String?   @db.Uuid
  billing_period_start DateTime? @db.Date
  billing_period_end   DateTime? @db.Date
  total_shipments      Int?
  base_amount          Decimal?  @db.Decimal(10, 2)
  penalties            Decimal?  @db.Decimal(10, 2)
  adjustments          Decimal?  @db.Decimal(10, 2)
  final_amount         Decimal?  @db.Decimal(10, 2)
  status               String?   @default("pending") @db.VarChar(50)
  created_at           DateTime? @default(now()) @db.Timestamptz(6)
  carriers             carriers? @relation(fields: [carrier_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model notifications {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String?   @db.Uuid
  type       String?   @db.VarChar(50)
  title      String?   @db.VarChar(255)
  message    String?
  link       String?   @db.VarChar(500)
  is_read    Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model order_items {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_id     String?        @db.Uuid
  product_id   String?        @db.Uuid
  sku          String?        @db.VarChar(100)
  product_name String?        @db.VarChar(255)
  quantity     Int
  unit_price   Decimal?       @db.Decimal(10, 2)
  weight       Decimal?       @db.Decimal(10, 2)
  warehouse_id String?        @db.Uuid
  created_at   DateTime?      @default(now()) @db.Timestamptz(6)
  orders       orders?        @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products     products?      @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses   warehouses?    @relation(fields: [warehouse_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  return_items return_items[]
}

model orders {
  id                 String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  order_number       String        @unique @db.VarChar(50)
  customer_name      String        @db.VarChar(255)
  customer_email     String?       @db.VarChar(255)
  customer_phone     String?       @db.VarChar(20)
  status             String?       @default("created") @db.VarChar(50)
  priority           String?       @default("standard") @db.VarChar(20)
  total_amount       Decimal?      @db.Decimal(10, 2)
  currency           String?       @default("USD") @db.VarChar(3)
  shipping_address   Json
  billing_address    Json?
  estimated_delivery DateTime?     @db.Timestamptz(6)
  actual_delivery    DateTime?     @db.Timestamptz(6)
  notes              String?
  created_at         DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?     @default(now()) @db.Timestamptz(6)
  exceptions         exceptions[]
  order_items        order_items[]
  returns            returns[]
  shipments          shipments[]

  @@index([created_at], map: "idx_orders_created_at")
  @@index([status], map: "idx_orders_status")
}

model organizations {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String    @db.VarChar(255)
  code       String    @unique @db.VarChar(50)
  is_active  Boolean?  @default(true)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users[]
}

model products {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sku             String            @unique @db.VarChar(100)
  name            String            @db.VarChar(255)
  category        String?           @db.VarChar(100)
  weight          Decimal?          @db.Decimal(10, 2)
  dimensions      Json?
  unit_price      Decimal?          @db.Decimal(10, 2)
  is_active       Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?         @default(now()) @db.Timestamptz(6)
  inventory       inventory[]
  order_items     order_items[]
  return_items    return_items[]
  stock_movements stock_movements[]
}

model rate_cards {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  carrier_id         String?   @db.Uuid
  origin_state       String?   @db.VarChar(100)
  destination_state  String?   @db.VarChar(100)
  service_type       String?   @db.VarChar(50)
  base_rate          Decimal?  @db.Decimal(10, 2)
  per_kg_rate        Decimal?  @db.Decimal(10, 2)
  fuel_surcharge_pct Decimal?  @db.Decimal(5, 2)
  effective_from     DateTime? @db.Date
  effective_to       DateTime? @db.Date
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  carriers           carriers? @relation(fields: [carrier_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model return_items {
  id            String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  return_id     String?      @db.Uuid
  order_item_id String?      @db.Uuid
  product_id    String?      @db.Uuid
  quantity      Int
  reason_detail String?
  created_at    DateTime?    @default(now()) @db.Timestamptz(6)
  order_items   order_items? @relation(fields: [order_item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products      products?    @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  returns       returns?     @relation(fields: [return_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model returns {
  id                                              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rma_number                                      String         @unique @db.VarChar(50)
  order_id                                        String?        @db.Uuid
  shipment_id                                     String?        @db.Uuid
  reason                                          String?        @db.VarChar(255)
  status                                          String?        @default("requested") @db.VarChar(50)
  return_shipment_id                              String?        @db.Uuid
  quality_check_result                            String?        @db.VarChar(50)
  refund_amount                                   Decimal?       @db.Decimal(10, 2)
  restocking_fee                                  Decimal?       @db.Decimal(10, 2)
  requested_at                                    DateTime?      @default(now()) @db.Timestamptz(6)
  resolved_at                                     DateTime?      @db.Timestamptz(6)
  created_at                                      DateTime?      @default(now()) @db.Timestamptz(6)
  return_items                                    return_items[]
  orders                                          orders?        @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  shipments_returns_return_shipment_idToshipments shipments?     @relation("returns_return_shipment_idToshipments", fields: [return_shipment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  shipments_returns_shipment_idToshipments        shipments?     @relation("returns_shipment_idToshipments", fields: [shipment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model shipment_events {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shipment_id     String?    @db.Uuid
  event_type      String     @db.VarChar(50)
  location        Json?
  description     String?
  event_timestamp DateTime   @db.Timestamptz(6)
  created_at      DateTime?  @default(now()) @db.Timestamptz(6)
  shipments       shipments? @relation(fields: [shipment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model shipments {
  id                                            String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tracking_number                               String            @unique @db.VarChar(100)
  order_id                                      String?           @db.Uuid
  carrier_id                                    String?           @db.Uuid
  warehouse_id                                  String?           @db.Uuid
  status                                        String?           @default("pending") @db.VarChar(50)
  origin_address                                Json?
  destination_address                           Json?
  weight                                        Decimal?          @db.Decimal(10, 2)
  dimensions                                    Json?
  shipping_cost                                 Decimal?          @db.Decimal(10, 2)
  pickup_scheduled                              DateTime?         @db.Timestamptz(6)
  pickup_actual                                 DateTime?         @db.Timestamptz(6)
  delivery_scheduled                            DateTime?         @db.Timestamptz(6)
  delivery_actual                               DateTime?         @db.Timestamptz(6)
  current_location                              Json?
  created_at                                    DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at                                    DateTime?         @default(now()) @db.Timestamptz(6)
  eta_predictions                               eta_predictions[]
  exceptions                                    exceptions[]
  returns_returns_return_shipment_idToshipments returns[]         @relation("returns_return_shipment_idToshipments")
  returns_returns_shipment_idToshipments        returns[]         @relation("returns_shipment_idToshipments")
  shipment_events                               shipment_events[]
  carriers                                      carriers?         @relation(fields: [carrier_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders                                        orders?           @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses                                    warehouses?       @relation(fields: [warehouse_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sla_violations                                sla_violations[]

  @@index([carrier_id], map: "idx_shipments_carrier")
  @@index([status], map: "idx_shipments_status")
}

model sla_policies {
  id                 String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String           @db.VarChar(255)
  service_type       String?          @db.VarChar(50)
  origin_region      String?          @db.VarChar(100)
  destination_region String?          @db.VarChar(100)
  delivery_hours     Int
  penalty_per_hour   Decimal?         @db.Decimal(10, 2)
  is_active          Boolean?         @default(true)
  created_at         DateTime?        @default(now()) @db.Timestamptz(6)
  sla_violations     sla_violations[]
}

model sla_violations {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shipment_id       String?       @db.Uuid
  sla_policy_id     String?       @db.Uuid
  promised_delivery DateTime?     @db.Timestamptz(6)
  actual_delivery   DateTime?     @db.Timestamptz(6)
  delay_hours       Decimal?      @db.Decimal(10, 2)
  penalty_amount    Decimal?      @db.Decimal(10, 2)
  reason            String?       @db.VarChar(255)
  status            String?       @default("open") @db.VarChar(50)
  created_at        DateTime?     @default(now()) @db.Timestamptz(6)
  shipments         shipments?    @relation(fields: [shipment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sla_policies      sla_policies? @relation(fields: [sla_policy_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([status], map: "idx_sla_violations_status")
}

model stock_movements {
  id             String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  warehouse_id   String?     @db.Uuid
  product_id     String?     @db.Uuid
  movement_type  String?     @db.VarChar(50)
  quantity       Int
  reference_type String?     @db.VarChar(50)
  reference_id   String?     @db.Uuid
  notes          String?
  created_by     String?     @db.Uuid
  created_at     DateTime?   @default(now()) @db.Timestamptz(6)
  users          users?      @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products       products?   @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses     warehouses? @relation(fields: [warehouse_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model user_permissions {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String?   @db.Uuid
  permission String    @db.VarChar(100)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email            String             @unique @db.VarChar(255)
  password_hash    String             @db.VarChar(255)
  name             String             @db.VarChar(255)
  role             String             @db.VarChar(50)
  organization_id  String?            @db.Uuid
  avatar           String?            @db.VarChar(500)
  is_active        Boolean?           @default(true)
  last_login       DateTime?          @db.Timestamptz(6)
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  audit_logs       audit_logs[]
  exceptions       exceptions[]
  notifications    notifications[]
  stock_movements  stock_movements[]
  user_permissions user_permissions[]
  organizations    organizations?     @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  warehouses       warehouses[]
}

model warehouses {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code            String            @unique @db.VarChar(50)
  name            String            @db.VarChar(255)
  address         Json
  capacity        Int?
  manager_id      String?           @db.Uuid
  is_active       Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?         @default(now()) @db.Timestamptz(6)
  inventory       inventory[]
  order_items     order_items[]
  shipments       shipments[]
  stock_movements stock_movements[]
  users           users?            @relation(fields: [manager_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
